# ES6 对象扩展与新增方法详解

ES6 对对象进行了大幅增强，提供了更简洁的语法和更强大的功能。以下是全面的解析：

## 一、对象字面量扩展

### 1. 属性简写 (Property Shorthand)
```javascript
const name = 'Alice';
const age = 30;

// ES5
const es5Obj = { 
  name: name, 
  age: age 
};

// ES6 简写
const es6Obj = { name, age };
console.log(es6Obj); // { name: 'Alice', age: 30 }
```

### 2. 方法简写 (Method Shorthand)
```javascript
// ES5
const es5Obj = {
  sayHello: function() {
    return 'Hello!';
  }
};

// ES6 简写
const es6Obj = {
  sayHello() {
    return 'Hello from ES6!';
  }
};
console.log(es6Obj.sayHello()); // "Hello from ES6!"
```

### 3. 计算属性名 (Computed Property Names)
```javascript
const propKey = 'user_' + Math.random().toString(36).substr(2, 5);
const dynamicValue = 'Dynamic Value';

const obj = {
  [propKey]: dynamicValue,
  ['full_' + propKey]: 'Full ' + dynamicValue
};

console.log(obj); // { user_abc12: 'Dynamic Value', full_user_abc12: 'Full Dynamic Value' }
```

## 二、对象新增方法

### 1. Object.is() - 严格值比较
```javascript
console.log(Object.is(NaN, NaN));    // true
console.log(Object.is(+0, -0));      // false
console.log(Object.is(5, '5'));      // false

// 与 === 对比
console.log(NaN === NaN);            // false
console.log(+0 === -0);              // true
```

### 2. Object.assign() - 对象合并
```javascript
const target = { a: 1, b: 2 };
const source1 = { b: 3, c: 4 };
const source2 = { d: 5 };

const result = Object.assign(target, source1, source2);
console.log(result); // { a: 1, b: 3, c: 4, d: 5 }
console.log(target); // 原对象也被修改 { a: 1, b: 3, c: 4, d: 5 }

// 创建新对象（推荐）
const newObj = Object.assign({}, target, { e: 6 });
console.log(newObj); // { a: 1, b: 3, c: 4, d: 5, e: 6 }

// 注意：浅拷贝！
const original = { nested: { value: 10 } };
const copy = Object.assign({}, original);
copy.nested.value = 20;
console.log(original.nested.value); // 20（原对象也被修改）
```

### 3. Object.keys() / Object.values() / Object.entries()
```javascript
const user = { 
  name: 'Bob', 
  age: 25, 
  [Symbol('id')]: 123 
};

// 获取可枚举属性键
console.log(Object.keys(user)); // ['name', 'age']

// 获取可枚举属性值
console.log(Object.values(user)); // ['Bob', 25]

// 获取键值对数组
console.log(Object.entries(user)); 
// [ ['name', 'Bob'], ['age', 25] ]

// 实用：对象转Map
const map = new Map(Object.entries(user));
console.log(map.get('name')); // 'Bob'

// 实用：遍历对象
Object.entries(user).forEach(([key, value]) => {
  console.log(`${key}: ${value}`);
});
```

### 4. Object.fromEntries() (ES2019)
```javascript
// 键值对数组转对象
const entries = [['name', 'Carol'], ['age', 28]];
const obj = Object.fromEntries(entries);
console.log(obj); // { name: 'Carol', age: 28 }

// Map转对象
const map = new Map([['country', 'USA'], ['city', 'NY']]);
console.log(Object.fromEntries(map)); // { country: 'USA', city: 'NY' }

// 查询参数转对象
const params = new URLSearchParams('name=Dave&age=32');
console.log(Object.fromEntries(params)); // { name: 'Dave', age: '32' }
```

### 5. Object.getOwnPropertyDescriptors()
```javascript
const obj = {
  [Symbol('secret')]: 123,
  get name() { return this._name; },
  set name(value) { this._name = value; }
};

const descriptors = Object.getOwnPropertyDescriptors(obj);
console.log(descriptors);
/*
{
  name: {
    get: [Function: get name],
    set: [Function: set name],
    enumerable: true,
    configurable: true
  },
  _name: { ... },
  [Symbol(secret)]: { ... }
}
*/

// 使用场景：精确复制对象（包括访问器属性）
const clone = Object.create(
  Object.getPrototypeOf(obj),
  Object.getOwnPropertyDescriptors(obj)
);
```

### 6. Object.setPrototypeOf() / Object.getPrototypeOf()
```javascript
const parent = { greet() { return 'Hello!'; } };
const child = {};

// 设置原型
Object.setPrototypeOf(child, parent);

console.log(child.greet()); // 'Hello!'
console.log(Object.getPrototypeOf(child) === parent); // true
```

## 三、其他重要特性

### 1. 扩展运算符 (...) 用于对象 (ES2018)
```javascript
const defaults = { theme: 'light', fontSize: 16 };
const userSettings = { theme: 'dark' };

// 合并对象（类似Object.assign，但创建新对象）
const settings = { ...defaults, ...userSettings, fontSize: 18 };
console.log(settings); // { theme: 'dark', fontSize: 18 }

// 浅拷贝对象
const original = { a: 1, b: { c: 2 } };
const copy = { ...original };
copy.b.c = 3;
console.log(original.b.c); // 3（嵌套对象仍是引用）
```

### 2. super 关键字
```javascript
const parent = {
  greet() {
    return 'Hello from parent!';
  }
};

const child = {
  __proto__: parent,  // 设置原型（不推荐直接使用__proto__）
  greet() {
    return super.greet() + ' And from child!';
  }
};

console.log(child.greet()); 
// "Hello from parent! And from child!"
```

### 3. 属性枚举顺序
ES6 规范了对象属性的枚举顺序：
1. 数字键（升序）
2. 字符串键（按创建顺序）
3. Symbol 键（按创建顺序）

```javascript
const obj = {
  2: 'two',
  'b': 'beta',
  1: 'one',
  'a': 'alpha',
  [Symbol('s2')]: 'symbol2',
  [Symbol('s1')]: 'symbol1'
};

console.log(Reflect.ownKeys(obj)); 
// [ '1', '2', 'b', 'a', Symbol(s2), Symbol(s1) ]
```

## 四、最佳实践与注意事项

1. **优先使用对象扩展运算符 (...)**
   ```javascript
   // 优于 Object.assign
   const newObj = { ...oldObj, updated: true };
   ```

2. **const 声明对象时，内容仍可修改**
   ```javascript
   const obj = { value: 10 };
   obj.value = 20; // 允许
   obj = {};       // TypeError: 常量赋值
   ```

3. **深拷贝需要特殊处理**
   ```javascript
   // 简单深拷贝
   const deepCopy = JSON.parse(JSON.stringify(original));
   
   // 使用库如 lodash.cloneDeep
   ```

4. **避免直接使用 __proto__**
   ```javascript
   // 不推荐
   obj.__proto__ = parent;
   
   // 推荐
   Object.setPrototypeOf(obj, parent);
   ```

5. **使用 Object.freeze() 防止修改**
   ```javascript
   const constants = Object.freeze({
     PI: 3.14159,
     MAX_SIZE: 100
   });
   
   constants.PI = 3.14; // 静默失败（严格模式报错）
   ```

## 五、实际应用场景

### 1. 配置对象合并
```javascript
function init(config) {
  const defaults = { logLevel: 'info', maxConnections: 10 };
  const finalConfig = { ...defaults, ...config };
  // 使用 finalConfig...
}
```

### 2. 创建不可变状态
```javascript
const currentState = { user: 'Alice', items: [1, 2, 3] };

// 更新状态（不修改原对象）
const newState = {
  ...currentState,
  items: [...currentState.items, 4]
};
```

### 3. 对象转换
```javascript
// 数组对象转换
const users = [
  { id: 1, name: 'Alice' },
  { id: 2, name: 'Bob' }
];

const userMap = Object.fromEntries(
  users.map(user => [user.id, user])
);
// { 1: {id:1, name:'Alice'}, 2: {id:2, name:'Bob'} }
```

### 4. 安全访问嵌套属性
```javascript
// 使用可选链 (ES2020) 和空值合并 (ES2020)
const city = user?.address?.city ?? 'Unknown';
```

ES6 对象扩展和方法新增极大地提升了 JavaScript 的对象操作能力，使代码更简洁、更强大且更易维护。合理运用这些特性可以显著提高开发效率。