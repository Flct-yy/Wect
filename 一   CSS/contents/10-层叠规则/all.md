# 层叠规则

CSS层叠规则（Cascade）是浏览器解决样式冲突、确定最终应用样式的核心机制

## 层叠概念与样式来源

**层叠本质**  
当同一元素的同一属性被多个样式声明指定时，浏览器通过层叠机制选择最终值。其决策依据包括：`来源优先级`、`选择器特异性`、`声明顺序`及`!important`标记。

**优先级(从低到高)**

* **浏览器默认样式**：如`<h1>`的粗体、`<em>`的斜体56。
* **用户样式**：用户自定义（如无障碍大字体）56。
* **作者样式表**（开发者提供）：
    * 外部样式表（`<link>`引入）
    * 内部样式表（`<style>`标签）
    * 行内样式（style属性）46。
* **!important声明**：打破常规优先级（用户!important > 作者!important）46。

## 核心层叠规则
1. 重要性规则  
    !important声明优先级最高，但慎用（易导致维护困难）。
2. 来源优先级规则  
    当无!important时，优先级排序：  
    行内样式 > 内部样式 > 外部样式 > 用户样式 > 浏览器默认
3. 特异性计算规则  
    选择器的特异性（Specificity）按 I-C-E 三元组计算：
    * ID选择器（#nav） → I+1
    * 类/伪类/属性选择器（.btn, :hover） → C+1
    * 元素/伪元素选择器（div, ::before） → E+1

    选择器示例|	特异性（I-C-E）	|权重值
    ----|----|----
    p|	0-0-1	|1
    p.text|	0-1-1	|11
    #header| .item:hover	1-2-0	|120
    style="color:blue"|	行内样式	|1000

    **比较规则**：从左到右逐级比较（如 1-0-0 > 0-10-10）。
4. 顺序规则  
    当来源与特异性均相同时，后声明的样式覆盖先声明的：
5. 继承规则  
    * 未直接指定样式时，元素继承父元素属性（如font-family）。
    * 直接指定样式 > 继承样式（即使继承来源特异性更高）。

## 层叠上下文详解

**层叠上下文作用**

    创建独立的Z轴渲染层，其内部元素的z-index仅在此上下文中比较

**创建条件**

属性类型|	示例
----|----
定位+非auto z-index|	position: relative; z-index: 1;
CSS3变换	|transform: scale(1);
透明度<1	|opacity: 0.9;
Flex容器+非auto z-index|	display: flex; z-index: 0;
滤镜效果	|filter: blur(5px);

**z-index的误区**

      仅在同一层叠上下文内比较数值大小。
      子上下文无法超越父上下文层级

## 层叠顺序规则
在层叠上下文中，元素按以下顺序堆叠（从下到上）：
* **背景/边框**：层叠上下文的背景色、边框。
* **负z-index**：z-index < 0的定位元素。
* **块级元素**：非定位的块级盒子（如div）。
* **浮动元素**：float: left/right的非定位元素。
* **行内元素**：非定位的行内盒子（如span）。
* **z-index:0/auto**：定位元素默认层级。
* **正z-index**：z-index > 0的定位元素（数值越大越靠上）。

💡 **关键记忆点**：背景最底 → 负z-index → 普通流元素 → 正z-index。