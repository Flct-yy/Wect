`Monorepo`（单一代码仓库）是一种软件开发策略，指**将多个相关项目（模块/包/服务）的代码存储在一个统一的版本控制仓库中**。这与传统的 `Polyrepo`（每个项目独立仓库）形成鲜明对比。

链接:https://juejin.cn/post/7215886869199896637#heading-3
---

### 核心特点：
1. **统一仓库**  
   所有项目（前端、后端、库、工具等）共享同一个根目录，通过子目录组织。
   ```bash
   monorepo/
   ├── apps/
   │   ├── web-app/      # 前端项目
   │   ├── mobile-app/   # 移动端项目
   │   └── api-service/  # 后端服务
   ├── packages/
   │   ├── shared-utils/ # 公共工具库
   │   └── ui-kit/       # UI组件库
   ├── scripts/          # 共享脚本
   └── package.json      # 根级配置（可能）
   ```

2. **共享依赖**  
   - 依赖可提升到根目录安装（如 `node_modules` 在根目录），减少重复安装。
   - 内部包直接通过路径引用（如 `"@project/ui-kit"`），避免发布到外部仓库。

3. **原子级提交**  
   一次提交可跨多个项目更新（如同时修改 `ui-kit` 和依赖它的 `web-app`），保证变更一致性。

4. **统一工具链**  
   使用标准化工具管理构建、测试、部署（如 `Turborepo`、`Nx`、`Rush`、`Bazel`）。

---

### 优势：
| 场景                  | Monorepo 解决方案                     |
|-----------------------|---------------------------------------|
| **代码复用**          | 共享代码（工具函数、组件）直接引用，无需发布包。 |
| **依赖管理**          | 统一版本，避免“依赖地狱”（如 React 版本冲突）。 |
| **跨项目重构**        | 一次提交更新所有依赖项目，减少协调成本。       |
| **一致性**            | 统一的代码规范、工具链、CI/CD流程。          |
| **可见性**            | 所有代码透明可见，便于协作和知识共享。         |

---

### 挑战：
- **仓库体积大**：历史提交可能臃肿（可用 `Git shallow clone` 或分片工具优化）。
- **工具复杂度**：需要配置构建/测试工具支持增量构建（如 `Turborepo` 缓存）。
- **权限控制**：精细的目录级权限需依赖 Git 子模块或特定工具（如 `Google Piper`）。
- **CI/CD 耗时**：需优化仅构建受影响项目（如 `Nx Affected`）。

---

### 典型应用场景：
1. **大型产品套件**（如 Google、Microsoft、Meta）  
   Google 将数十亿行代码放在单一仓库，保障跨团队协作。
2. **全栈应用**  
   同时管理前端、后端、共享类型定义。
3. **组件库驱动开发**  
   UI 组件库与多个应用项目同步迭代。
4. **微服务架构**  
   协调多个服务（需配合变更检测工具）。

---

### 常见工具：
| 工具         | 功能亮点                             |
|--------------|--------------------------------------|
| **Turborepo**| 增量构建 + 云缓存加速                |
| **Nx**       | 项目关系图 + 智能任务调度            |
| **Rush**     | 企业级 Monorepo 管理（微软开发）     |
| **Lerna**    | 传统方案（现常配合 Turborepo 使用）  |

---

### 何时避免使用？
- **无关项目组合**（如不同客户的独立项目）。
- **开源生态库**（独立版本管理更清晰）。
- **基础设施受限**（超大型仓库需要专业工具支持）。

---

### 示例：
```bash
# 使用 Turborepo 初始化 monorepo
npx create-turbo@latest
```
生成的典型结构：
```
my-turbo-repo/
├── apps/
│   └── docs/          # 应用1
├── packages/
│   └── shared-ui/     # 共享包
├── turbo.json         # 任务流水线配置
└── package.json       # 根依赖
```

> 💡 **总结**：Monorepo 通过集中管理提升协作效率，适合强关联的项目群。工具链的成熟（如 Turborepo）正推动其成为现代开发的主流选择。实际决策时需权衡项目规模、团队结构和基础设施支持。